<div class="modal fade" id="newRegionModal" tabindex="-1" aria-labelledby="newRegionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="border-bottom border-dark mb-3 text-center w-75 mx-auto">
          <h3 class="mb-1">New Region</h3>
        </div>

        <form id="region-form" action="" method="POST">
          {% csrf_token %}

          <div class="row mb-4 w-75 mx-auto">
            <div class="col-md-12 col-lg-6">
              <div class="form-group">
                <label for="region-name">Name:</label>
                <input class="form-control" type="text" name="region-name" id="region-name" />
              </div>
            </div>

            <div class="col-md-12 col-lg-6">
              <div class="form-group">
                <label for="region-code">Code:</label>
                <input name="region-code" id="region-code" class="form-control" />
              </div>
            </div>
          </div>

          <div class="item-select-container mb-4">
            <div class="available-pubs">
              Available Publications:<br />
              <select multiple="multiple" id="lstBox1" class="form-select">
                {% for pub in publications %}
                <option value="{{ pub.id }}">{{ pub.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="transferBtns d-flex flex-column align-items-center mx-3">
              <button type="button" class="btn btn-sm btn-secondary mb-2" id="btnAllRight">&gt;&gt;</button>
              <button type="button" class="btn btn-sm btn-secondary mb-2" id="btnRight">&gt;</button>
              <button type="button" class="btn btn-sm btn-secondary mb-2" id="btnLeft">&lt;</button>

              <button type="button" class="btn btn-sm btn-secondary" id="btnAllLeft">&lt;&lt;</button>
            </div>

            <div class="selected-pubs">
              Selected Publications:<br />
              <select multiple="multiple" id="lstBox2" name="publications" class="form-select"></select>
            </div>
          </div>

          <div class="btn-container text-center">
            <button id="submit-region" type="submit" class="btn btn-secondary">Create Region</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById('btnRight').onclick = function () {
    var from = document.getElementById('lstBox1');
    var to = document.getElementById('lstBox2');
    moveSelected(from, to);
  };

  document.getElementById('btnLeft').onclick = function () {
    var from = document.getElementById('lstBox2');
    var to = document.getElementById('lstBox1');
    moveSelected(from, to);
  };

  // New ‚ÄúMove All‚Äù buttons
  document.getElementById('btnAllRight').onclick = function () {
    moveAll(document.getElementById('lstBox1'), document.getElementById('lstBox2'));
  };
  document.getElementById('btnAllLeft').onclick = function () {
    moveAll(document.getElementById('lstBox2'), document.getElementById('lstBox1'));
  };

  function moveSelected(from, to) {
    for (var i = 0; i < from.options.length; i++) {
      if (from.options[i].selected) {
        let option = from.options[i];
        option.selected = false; // reset selection
        to.appendChild(option);
        i--; // adjust index
      }
    }
  }

  // Move all options
  function moveAll(from, to) {
    for (var i = 0; i < from.options.length; i++) {
      let option = from.options[i];
      option.selected = false;
      to.appendChild(option);
      i--;
    }
  }

  // üîë Before submitting, force all options in lstBox2 to be selected
  document.getElementById('region-form').onsubmit = function () {
    var selected = document.getElementById('lstBox2');
    for (var i = 0; i < selected.options.length; i++) {
      selected.options[i].selected = true;
    }
  };
</script>
